"use strict";

// 1) Raw permission arrays for all 20 roles, with replacements done here:
const raw = {
  // // Admin
  // "550e8400-e29b-41d4-a716-446655440000": ["ALL"],

  // User
  "a3d1c6b5-7e4c-44e8-a2b1-5c6d3a4e8f7b": [
    "edit tasks",
    "edit activities",
    "manage member schedule",
  ],

  // // Client
  // "aa192529-c692-458e-bf96-42b7d4782c3a": [],

  // HR Manager
  "bbb1ffa1-2683-4542-aebc-50f9eb5ebeb4": ["manage requests", "manage hr"],

  // Project Planner
  "2f9b6337-4e45-4b5a-bc6b-ceb84c84e63f": [
    "edit tasks",
    "delete tasks",
    "edit projects",
    "delete projects",
    "edit clients",
    "delete clients",
    "create projects",
    "create tasks",
    "create clients",
    "manage projects",
    "manage tasks",
    "manage clients",
    "create workspaces",
    "manage workspaces",
    "edit workspaces",
    "delete workspaces",
    "create meetings",
    "manage meetings",
    "edit meetings",
    "delete meetings",
    "delete contracts",
    "edit contracts",
    "manage contracts",
    "create contracts",
    "create timesheet",
    "delete timesheet",
    "manage timesheet",
    "delete activity log",
    "create milestones",
    "manage milestones",
    "edit milestones",
    "delete milestones",
    "manage system notifications",
    "delete system notifications",
    "project manager",
    "create activities",
    "update activities",
    "delete activities",
    "manage activities",
    "create requests",
    "update requests",
    "delete requests",
    "manage requests",
  ],

  // Warehouse Manager
  "dcdb769f-5f11-4ee1-ab10-b3ac86c1553b": [
    "create timesheet",
    "manage inventories",
    "manage requests",
  ],

  // Finance
  "13761808-4d09-433d-bb6e-39d3adb8c311": [
    "create payslips",
    "edit payslips",
    "delete payslips",
    "manage payslips",
    "create estimates invoices",
    "manage estimates invoices",
    "edit estimates invoices",
    "delete estimates invoices",
    "create expenses",
    "manage expenses",
    "edit expenses",
    "delete expenses",
    "manage requests",
  ],

  // Procurement
  "b12c1d62-1c78-4bb1-9e4f-772d48c3ec3a": ["manage inventories"],

  // Project Analyst
  "e9930d61-a42f-4a3e-9bda-586a266f6776": [
    "manage users",
    "manage projects",
    "manage tasks",
    "manage clients",
    "manage workspaces",
    "manage meetings",
    "manage contracts",
    "manage timesheet",
    "manage payslips",
    "manage expenses",
    "manage milestones",
    "manage system notifications",
    "manage inventories",
    "manage resource allocation",
    "manage requests",
    "manage hr",
    "manage master schedule",
    "manage admin schedule",
    "manage member schedule",
    "department",
    "manage activities",
    "manage requests",
  ],

  // Project Manager (same as Analyst)
  "e1ea8779-315f-4a3f-a795-3d041a1c4e17": [
    "manage users",
    "manage projects",
    "manage tasks",
    "manage clients",
    "manage workspaces",
    "manage meetings",
    "manage contracts",
    "manage timesheet",
    "manage payslips",
    "manage expenses",
    "manage milestones",
    "manage system notifications",
    "manage inventories",
    "manage resource allocation",
    "manage requests",
    "manage hr",
    "manage master schedule",
    "manage admin schedule",
    "manage member schedule",
    "department",
    "manage activities",
    "manage requests",
  ],

  // Consultant
  "a1f9408d-4371-4e86-957e-d0bcfe1b66ce": [
    "manage users",
    "manage projects",
    "manage tasks",
    "manage clients",
    "manage workspaces",
    "manage meetings",
    "manage contracts",
    "manage timesheet",
    "manage payslips",
    "manage estimates invoices",
    "manage expenses",
    "manage milestones",
    "manage activities",
    "manage requests",
  ],

  // Supervisor
  "809f4603-3930-4e79-b2b0-f15c0a6a9b8c": [
    "manage users",
    "manage projects",
    "manage tasks",
    "manage clients",
    "manage workspaces",
    "manage meetings",
    "manage contracts",
    "manage timesheet",
    "manage payslips",
    "manage activity log",
    "create estimates invoices",
    "manage estimates invoices",
    "create expenses",
    "manage expenses",
    "create milestones",
    "manage milestones",
    "manage system notifications",
    "manage inventories",
    "manage resource allocation",
    "manage requests",
    "manage hr",
    "manage master schedule",
    "manage admin schedule",
    "manage member schedule",
    "manage activities",
    "manage requests",
  ],

  // Site Engineer
  "e0c29db7-e7f0-4163-8ff8-0d8052b5ea0f": [
    "edit tasks",
    "delete tasks",
    "edit projects",
    "delete projects",
    "edit clients",
    "delete clients",
    "create projects",
    "create tasks",
    "create clients",
    "edit users",
    "delete users",
    "manage users",
    "manage projects",
    "manage tasks",
    "manage clients",
    "create users",
    "create workspaces",
    "manage workspaces",
    "edit workspaces",
    "delete workspaces",
    "create meetings",
    "manage meetings",
    "edit meetings",
    "delete meetings",
    "delete contracts",
    "edit contracts",
    "manage contracts",
    "create contracts",
    "create timesheet",
    "delete timesheet",
    "manage timesheet",
    "create payslips",
    "edit payslips",
    "delete payslips",
    "manage payslips",
    "manage activity log",
    "delete activity log",
    "create estimates invoices",
    "manage estimates invoices",
    "edit estimates invoices",
    "delete estimates invoices",
    "create expenses",
    "manage expenses",
    "edit expenses",
    "delete expenses",
    "create milestones",
    "manage milestones",
    "edit milestones",
    "delete milestones",
    "manage system notifications",
    "delete system notifications",
    "manage inventories",
    "manage resource allocation",
    "manage requests",
    "manage hr",
    "manage master schedule",
    "manage admin schedule",
    "manage member schedule",
    "department",
    "consultant",
    "project manager",
    "create activities",
    "update activities",
    "delete activities",
    "manage activities",
    "create requests",
    "update requests",
    "delete requests",
    "manage requests",
  ],

  // Building Engineer (same as Site Eng)
  "b26c1e02-77b5-4f64-b4e7-3ccbc45afa22": [
    "edit tasks",
    "delete tasks",
    "edit projects",
    "delete projects",
    "edit clients",
    "delete clients",
    "create projects",
    "create tasks",
    "create clients",
    "edit users",
    "delete users",
    "manage users",
    "manage projects",
    "manage tasks",
    "manage clients",
    "create users",
    "create workspaces",
    "manage workspaces",
    "edit workspaces",
    "delete workspaces",
    "create meetings",
    "manage meetings",
    "edit meetings",
    "delete meetings",
    "delete contracts",
    "edit contracts",
    "manage contracts",
    "create contracts",
    "create timesheet",
    "delete timesheet",
    "manage timesheet",
    "create payslips",
    "edit payslips",
    "delete payslips",
    "manage payslips",
    "manage activity log",
    "delete activity log",
    "create estimates invoices",
    "manage estimates invoices",
    "edit estimates invoices",
    "delete estimates invoices",
    "create expenses",
    "manage expenses",
    "edit expenses",
    "delete expenses",
    "create milestones",
    "manage milestones",
    "edit milestones",
    "delete milestones",
    "manage system notifications",
    "delete system notifications",
    "manage inventories",
    "manage resource allocation",
    "manage requests",
    "manage hr",
    "manage master schedule",
    "manage admin schedule",
    "manage member schedule",
    "department",
    "consultant",
    "project manager",
    "create activities",
    "update activities",
    "delete activities",
    "manage activities",
    "create requests",
    "update requests",
    "delete requests",
    "manage requests",
  ],

  // Office Engineer (same)
  "abcf88d0-39cb-4f15-b0cb-bb2eb47744c8": [
    "edit tasks",
    "delete tasks",
    "edit projects",
    "delete projects",
    "edit clients",
    "delete clients",
    "create projects",
    "create tasks",
    "create clients",
    "edit users",
    "delete users",
    "manage users",
    "manage projects",
    "manage tasks",
    "manage clients",
    "create users",
    "create workspaces",
    "manage workspaces",
    "edit workspaces",
    "delete workspaces",
    "create meetings",
    "manage meetings",
    "edit meetings",
    "delete meetings",
    "delete contracts",
    "edit contracts",
    "manage contracts",
    "create contracts",
    "create timesheet",
    "delete timesheet",
    "manage timesheet",
    "create payslips",
    "edit payslips",
    "delete payslips",
    "manage payslips",
    "manage activity log",
    "delete activity log",
    "create estimates invoices",
    "manage estimates invoices",
    "edit estimates invoices",
    "delete estimates invoices",
    "create expenses",
    "manage expenses",
    "edit expenses",
    "delete expenses",
    "create milestones",
    "manage milestones",
    "edit milestones",
    "delete milestones",
    "manage system notifications",
    "delete system notifications",
    "manage inventories",
    "manage resource allocation",
    "manage requests",
    "manage hr",
    "manage master schedule",
    "manage admin schedule",
    "manage member schedule",
    "department",
    "consultant",
    "project manager",
    "create activities",
    "update activities",
    "delete activities",
    "manage activities",
    "create requests",
    "update requests",
    "delete requests",
    "manage requests",
  ],

  // Equipment Manager
  "bf2c9607-86ef-4c34-8c05-bc76470c6d5b": ["manage inventories"],

  // Cashier
  "839a7bd9-ffa9-42ae-8539-1dcbc54f7880": [
    "delete contracts",
    "edit contracts",
    "manage contracts",
    "create contracts",
    "create payslips",
    "edit payslips",
    "delete payslips",
    "manage payslips",
    "create expenses",
    "manage expenses",
    "edit expenses",
    "delete expenses",
  ],

  // Water Works Engineer (same as Site Eng)
  "74614c3e-f433-4fb0-b791-1ed653a801f2": [
    "edit tasks",
    "delete tasks",
    "edit projects",
    "delete projects",
    "edit clients",
    "delete clients",
    "create projects",
    "create tasks",
    "create clients",
    "edit users",
    "delete users",
    "manage users",
    "manage projects",
    "manage tasks",
    "manage clients",
    "create users",
    "create workspaces",
    "manage workspaces",
    "edit workspaces",
    "delete workspaces",
    "create meetings",
    "manage meetings",
    "edit meetings",
    "delete meetings",
    "delete contracts",
    "edit contracts",
    "manage contracts",
    "create contracts",
    "create timesheet",
    "delete timesheet",
    "manage timesheet",
    "create payslips",
    "edit payslips",
    "delete payslips",
    "manage payslips",
    "manage activity log",
    "delete activity log",
    "create estimates invoices",
    "manage estimates invoices",
    "edit estimates invoices",
    "delete estimates invoices",
    "create expenses",
    "manage expenses",
    "edit expenses",
    "delete expenses",
    "create milestones",
    "manage milestones",
    "edit milestones",
    "delete milestones",
    "manage system notifications",
    "delete system notifications",
    "manage inventories",
    "manage resource allocation",
    "manage requests",
    "manage hr",
    "manage master schedule",
    "manage admin schedule",
    "manage member schedule",
    "department",
    "consultant",
    "project manager",
    "create activities",
    "update activities",
    "delete activities",
    "manage activities",
    "create requests",
    "update requests",
    "delete requests",
    "manage requests",
  ],

  // Foreman (similar to Supervisor)
  "6d77a086-8982-4c98-88f0-99c6b9979cc8": [
    "manage users",
    "manage projects",
    "manage tasks",
    "manage clients",
    "manage workspaces",
    "manage meetings",
    "manage contracts",
    "manage timesheet",
    "manage payslips",
    "manage activity log",
    "create estimates invoices",
    "manage estimates invoices",
    "create expenses",
    "manage expenses",
    "create milestones",
    "manage milestones",
    "manage system notifications",
    "manage inventories",
    "manage resource allocation",
    "manage requests",
    "manage hr",
    "manage master schedule",
    "manage admin schedule",
    "manage member schedule",
    "manage activities",
    "manage requests",
  ],

  // Quality Control (similar)
  "cd8f47e9-982e-4f0f-a779-805946b47292": [
    "manage users",
    "manage projects",
    "manage tasks",
    "manage clients",
    "manage workspaces",
    "manage meetings",
    "manage contracts",
    "manage timesheet",
    "manage payslips",
    "manage activity log",
    "create estimates invoices",
    "manage estimates invoices",
    "create expenses",
    "manage expenses",
    "create milestones",
    "manage milestones",
    "manage system notifications",
    "manage inventories",
    "manage resource allocation",
    "manage requests",
    "manage hr",
    "manage master schedule",
    "manage admin schedule",
    "manage member schedule",
    "manage activities",
    "manage requests",
  ],
};

// 2) Simple camelCase helper
function toCamelCase(str) {
  return str
    .toLowerCase()
    .replace(/[^a-z0-9 ]+/g, "")
    .split(" ")
    .map((w, i) => (i === 0 ? w : w[0].toUpperCase() + w.slice(1)))
    .join("");
}

// 3) Build the permissions JSON from each raw array
function buildPerms(arr) {
  const p = {};
  for (const entry of arr) {
    const [action, ...rest] = entry.split(" ");
    const resource = toCamelCase(rest.join(" "));
    if (!action || !resource) continue;
    p[resource] = p[resource] || {};
    p[resource][action] = true;
  }
  return p;
}

module.exports = {
  async up(queryInterface, Sequelize) {
    for (const [roleId, arr] of Object.entries(raw)) {
      const permissions = buildPerms(arr);
      await queryInterface.bulkUpdate("roles", { permissions }, { id: roleId });
    }
  },

  async down(queryInterface, Sequelize) {
    for (const roleId of Object.keys(raw)) {
      await queryInterface.bulkUpdate(
        "roles",
        { permissions: null },
        { id: roleId }
      );
    }
  },
};
